name: "Check docs links"

on:
  workflow_dispatch:
  push:
    branches:
      - master
    paths:
      - "docs/**"
      - ".github/workflows/documentation-links.yml"
  pull_request:
    paths:
      - "docs/**"
      - ".github/workflows/documentation-links.yml"

jobs:
  linkChecker:
    if: github.actor != 'dependabot[bot]'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332

      - name: Link Checker
        id: lychee
        uses: lycheeverse/lychee-action@2b973e86fc7b1f6b36a93795fe2c9c6ae1118621
        
      - name: Find the last open report issue
        id: last-issue
        uses: micalevisk/last-issue-action@044e1cb7e9a4dde20e22969cb67818bfca0797be
        with:
          state: open
          # Find the last updated open issue that has these labels:
          labels: |
            report
            automated-issue

      - name: Create Issue From File
        if: env.lychee_exit_code != 0
        uses: peter-evans/create-issue-from-file@24452a72d85239eacf1468b0f1982a9f3fec4c94
        with:
          title: Link Checker Report
          content-filepath: ./lychee/out.md
          issue-number: ${{ steps.last-issue.outputs.issue_number }}
          labels: |
            report
            automated-issue
          assignees: VictorAvelar
